const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["ConfigureTheView-B13Ta6yT.js","strapi-DrcOIabe.js","strapi-D6821bIJ.css"])))=>i.map(i=>d[i]);
import{a as A,w as _e,ch as $e,cd as Ue,ck as Be,eY as Q,cs as r,j as e,$ as w,H as $,dh as De,dk as Pe,dl as Ve,f as F,fC as nt,fD as we,fE as it,r as y,di as ot,T as ee,dm as dt,dp as lt,dn as rt,fF as ct,M as D,aX as Se,ct as Fe,l as v,fG as Qe,fH as ut,bI as Z,I as H,bB as ze,bJ as Oe,cz as p,h as He,fI as pt,fJ as ht,dj as K,fK as z,fL as gt,fM as ft,fN as xt,fO as mt,eF as jt,cc as yt,fP as Ct,fQ as Ge,fR as bt,D as k,d9 as At,fS as vt,bE as Ne,cq as Mt,cp as wt,fT as G,fU as St,fV as Ft,L as kt,bt as It,bu as Tt,fW as Et,fX as Lt,fg as Rt,fY as _t,fZ as $t,f_ as Ut,aJ as ue,u as te,dG as ke,f$ as Bt,g0 as Dt,g1 as Ie,g2 as Pt,aO as We,C as Y,bV as Vt,aQ as qe,aI as Qt,eD as zt,g3 as Ot,V as Ht,b as Gt,g4 as Nt,g5 as Wt,g6 as qt,g7 as Jt,g8 as Kt,g9 as Xt,P,a3 as Yt,cD as Zt,ga as es,gb as ts,gc as X,gd as ss,ge as as,gf as ns,gg as is,gh as os,gi as ds,bF as ls,bm as rs,gj as cs,cS as ce,gk as us,gl as ps,gm as hs,gn as gs,e_ as fs,R as xs,Q as Te,_ as ms}from"./strapi-DrcOIabe.js";import{S as js}from"./SearchInput-BPyosaMd.js";const ys=()=>{const{formatMessage:t}=A(),{toggleNotification:n}=_e(),s=$e(),{post:a}=Ue(),o=Be(({updates:h})=>a("/upload/actions/bulk-update",{updates:h}),{onSuccess(h){const{data:m}=h;m&&m.length>0&&(s.refetchQueries([Q,"assets"],{active:!0}),s.refetchQueries([Q,"asset-count"],{active:!0}),s.refetchQueries([Q,"folders"],{active:!0})),n({type:"success",message:t({id:r("modal.edit.success-label"),defaultMessage:"Files have been successfully updated."})})}});return{...o,edit:h=>o.mutateAsync({updates:h})}},Je=v(xt)`
  opacity: 0;
  z-index: 1;

  &:focus-within {
    opacity: 1;
  }
`,Cs=v(w)`
  background: ${({theme:t})=>t.colors.neutral0};
  border: 1px solid ${({theme:t})=>t.colors.neutral150};
  border-radius: ${({theme:t})=>t.borderRadius};

  &:hover {
    ${Je} {
      opacity: 1;
    }
  }
`,bs=({asset:t})=>{const{formatMessage:n}=A(),s=O("AssetCardActions",i=>i.dispatch),a=O("AssetCardActions",i=>i.state),l=O("AssetCardActions",i=>i.onClose),{canUpdate:o,canCopyLink:u,canDownload:h}=Qe(),[m,g]=y.useState(!1),{removeAsset:j}=ut(()=>{}),f=async i=>{i?.preventDefault(),await j(t.id),s({type:"remove_uploaded_asset",payload:{id:t.id}}),a.uploadedAssets.length===1&&l()},x=i=>{i.stopPropagation()},M=i=>{i&&(s({type:"edit_uploaded_asset",payload:{editedAsset:i}}),g(!1))};return e.jsxs(Je,{onClick:x,position:"end",children:[e.jsxs(Z.Root,{children:[e.jsx(Z.Trigger,{children:e.jsx(H,{label:n({id:r("control-card.remove-selection"),defaultMessage:"Remove from selection"}),children:e.jsx(ze,{})})}),e.jsx(Oe,{onConfirm:f})]}),e.jsxs(p.Root,{open:m,onOpenChange:g,children:[e.jsx(p.Trigger,{children:e.jsx(H,{label:n({id:r("control-card.edit"),defaultMessage:"Edit"}),children:e.jsx(He,{})})}),e.jsx(p.Content,{children:e.jsx(pt,{asset:{...t,isLocal:!1,folder:typeof t.folder=="number"?{id:t.folder}:t.folder},onClose:i=>M(i),canUpdate:o,canCopyLink:u,canDownload:h,omitFields:["caption","alternativeText"],omitActions:["replace"]})})]})]})},As=v.span`
  text-transform: uppercase;
`,vs=v(w)`
  position: relative;
  height: 100%;
  overflow: hidden;

  canvas,
  video {
    display: block;
    pointer-events: none;
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: ${({theme:t})=>t.borderRadius};
  }
`,Ms=v(mt)`
  position: absolute;
  bottom: 0.5rem;
  right: 0.5rem;
`,ws=v(w)`
  height: 100%;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;

  canvas,
  audio {
    display: block;
    max-width: 100%;
    max-height: 100%;
  }
`,Ss=({assetType:t,thumbnailUrl:n,assetUrl:s,asset:a})=>{const[l,o]=y.useState(),u=l?ht(l):void 0;switch(t){case z.Image:return e.jsx(K,{src:n,size:"S",alt:a.alternativeText||a.name});case z.Video:return e.jsx(K,{size:"S",children:e.jsxs(vs,{children:[e.jsx(ft,{url:s,mime:a.mime||"video/mp4",onLoadDuration:o,alt:a.alternativeText||a.name}),u&&e.jsx(Ms,{children:u})]})});case z.Audio:return e.jsx(K,{size:"S",children:e.jsx(ws,{children:e.jsx(gt,{url:s,alt:a.alternativeText||a.name})})});default:return e.jsx(K,{src:n,size:"S",alt:a.alternativeText||a.name})}},Fs=v(Pe)`
  display: flex;
  padding: ${({theme:t})=>t.spaces[2]} ${({theme:t})=>t.spaces[1]};
`,ks=v(De)`
  width: 100%;
  height: 100%;
  border: none;
  box-shadow: none;
  border-radius: 0;
  padding: 0;
`,Is=t=>{switch(t){case z.Image:return{id:r("settings.section.image.label"),defaultMessage:"IMAGE"};case z.Video:return{id:r("settings.section.video.label"),defaultMessage:"VIDEO"};case z.Audio:return{id:r("settings.section.audio.label"),defaultMessage:"AUDIO"};default:return{id:r("settings.section.doc.label"),defaultMessage:"DOC"}}},Ts=({asset:t,onCaptionChange:n,onAltTextChange:s,wasAltTextChanged:a,wasCaptionChanged:l})=>{const{formatMessage:o}=A(),u=nt(t.mime||""),h=we(t?.formats?.thumbnail?.url||t.url)||"",m=we(t.url)||"",g=t.height&&t.width?` - ${t.width}x${t.height}`:"",j=t.size?it(t.size):"",f=`${g}${g&&j?" - ":""}${j}`,[x,M]=y.useState(t.caption||"");y.useEffect(()=>{n(x)},[x,n]);const[i,I]=y.useState(t.alternativeText||"");return y.useEffect(()=>{s(i)},[i,s]),e.jsx(Cs,{children:e.jsxs($.Root,{children:[e.jsx($.Item,{col:5,alignItems:"stretch",children:e.jsxs(ks,{width:"100%",height:"100%",shadow:"none",borderRadius:0,padding:0,children:[e.jsxs(ot,{style:{borderStyle:"none"},children:[e.jsx(bs,{asset:t}),e.jsx(Ss,{assetType:u,thumbnailUrl:h,assetUrl:m,asset:t})]}),e.jsx(Fs,{children:e.jsxs(Ve,{width:"100%",children:[e.jsxs(F,{justifyContent:"space-between",alignItems:"start",children:[e.jsx(ee,{tag:"h2",children:e.jsx(dt,{tag:"span",children:t.name})}),e.jsx(lt,{children:o(Is(u))})]}),e.jsx(F,{children:e.jsxs(rt,{children:[e.jsx(As,{children:ct(t.ext)}),f]})})]})})]})}),e.jsx($.Item,{col:7,flex:1,children:e.jsxs(F,{direction:"column",height:"100%",alignItems:"stretch",flex:1,padding:4,gap:2,children:[e.jsxs(D.Root,{name:"caption",children:[e.jsx(F,{alignItems:"center",gap:2,children:e.jsx(D.Label,{children:o({id:r("form.input.label.file-caption"),defaultMessage:"Caption"})})}),e.jsx(Se,{value:x,onChange:S=>M(S.target.value),placeholder:o({id:r("form.input.placeholder.file-caption"),defaultMessage:"Enter caption"}),endAction:!l&&t.caption&&e.jsx(Fe,{width:"16px",height:"16px",fill:"#AC73E6"}),type:"text"})]}),e.jsxs(D.Root,{name:"alternativeText",hint:o({id:r("form.input.description.file-alt"),defaultMessage:"This text will be displayed if the asset can't be shown."}),children:[e.jsx(F,{alignItems:"center",gap:2,children:e.jsx(D.Label,{children:o({id:r("form.input.label.file-alt"),defaultMessage:"Alternative text"})})}),e.jsx(Se,{value:i,onChange:S=>I(S.target.value),placeholder:o({id:r("form.input.placeholder.file-alt"),defaultMessage:"Enter alternative text"}),endAction:!a&&t.alternativeText&&e.jsx(Fe,{width:"16px",height:"16px",fill:"#AC73E6"}),type:"text"}),e.jsx(D.Hint,{})]})]})})]})})},_=v(w)`
  background: linear-gradient(
    90deg,
    ${({theme:t})=>t.colors.neutral100} 25%,
    ${({theme:t})=>t.colors.neutral150} 50%,
    ${({theme:t})=>t.colors.neutral100} 75%
  );
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
  border-radius: ${({theme:t})=>t.borderRadius};
  width: ${({width:t})=>t||"100%"};
  height: ${({height:t})=>t||"1rem"};

  @keyframes loading {
    0% {
      background-position: 200% 0;
    }
    100% {
      background-position: -200% 0;
    }
  }
`,Es=({count:t=1})=>Array.from({length:t},(s,a)=>a).map(s=>e.jsx(w,{background:"neutral0",borderColor:"neutral150",borderStyle:"solid",borderWidth:"1px",borderRadius:"4px",marginBottom:4,children:e.jsxs($.Root,{children:[e.jsx($.Item,{col:5,alignItems:"stretch",children:e.jsxs(De,{height:"100%",width:"100%",borderStyle:"none",shadow:"none",borderRadius:0,padding:2,children:[e.jsx(w,{height:"150px",padding:2,children:e.jsx(_,{height:"100%"})}),e.jsx(Pe,{style:{display:"flex",padding:"8px 4px"},children:e.jsxs(Ve,{width:"100%",children:[e.jsxs(F,{justifyContent:"space-between",alignItems:"start",marginBottom:1,children:[e.jsx(_,{width:"60%",height:"18px"}),e.jsx(_,{width:"40px",height:"16px"})]}),e.jsx(_,{width:"80%",height:"14px"})]})})]})}),e.jsx($.Item,{col:7,flex:1,children:e.jsxs(F,{direction:"column",height:"100%",alignItems:"stretch",flex:1,padding:4,gap:2,children:[e.jsxs(w,{children:[e.jsx(_,{width:"60px",height:"16px",marginBottom:1}),e.jsx(_,{height:"32px"})]}),e.jsxs(w,{children:[e.jsx(_,{width:"100px",height:"16px",marginBottom:1}),e.jsx(_,{height:"32px"}),e.jsx(w,{marginTop:1,children:e.jsx(_,{width:"70%",height:"12px"})})]})]})})]})},s)),Ee=v(p.Body)`
  padding: 0;
  display: flex;
  justify-content: center;

  [data-radix-scroll-area-viewport] {
    padding-top: ${({theme:t})=>t.spaces[6]};
    padding-bottom: ${({theme:t})=>t.spaces[6]};
    padding-left: ${({theme:t})=>t.spaces[7]};
    padding-right: ${({theme:t})=>t.spaces[7]};
  }
`,Ls=v(At)`
  & > button {
    display: none;
  }
`,Rs=({onClose:t})=>{const{formatMessage:n}=A(),s=O("ModalContent",c=>c.state),a=O("ModalContent",c=>c.dispatch),l=O("ModalContent",c=>c.folderId),{upload:o}=Ct(),{edit:u,isLoading:h}=ys(),[m,g]=y.useState(!1),[j,f]=y.useState(null),{trackUsage:x}=Ge(),M=(c,C)=>{a({type:"set_uploaded_asset_caption",payload:{id:c,caption:C}})},i=(c,C)=>{a({type:"set_uploaded_asset_alt_text",payload:{id:c,altText:C}})},I=()=>{a({type:"set_uploaded_assets",payload:[]})},S=async()=>{if(s.hasUnsavedChanges){const c=s.uploadedAssets.filter(C=>(C.wasCaptionChanged||C.wasAltTextChanged)&&C.file.id);if(c.length>0){c.some(b=>b.wasCaptionChanged)&&x("didEditAICaption"),c.some(b=>b.wasAltTextChanged)&&x("didEditAIAlternativeText");const C=c.map(b=>({id:b.file.id,fileInfo:{name:b.file.name,alternativeText:b.file.alternativeText??null,caption:b.file.caption??null,folder:typeof b.file.folder=="object"&&b.file.folder!==null?b.file.folder.id:b.file.folder}}));try{await u(C),a({type:"clear_unsaved_changes"})}catch(b){console.error("Failed to save asset changes:",b);return}}}I(),t()},N=()=>{I(),t()},se=async c=>{a({type:"set_assets_to_upload_length",payload:c.length}),f(null),g(!0);try{const C=c.map(U=>({...U,id:U.id?Number(U.id):void 0})),B=(await o(C,l)).map(U=>({...U,folder:l||U.folder}));a({type:"set_uploaded_assets",payload:B})}catch(C){console.error("Upload failed:",C),f(C instanceof Error?C:new Error("Upload failed"))}finally{g(!1)}};if(s.assetsToUploadLength===0)return e.jsx(p.Content,{children:e.jsx(bt,{onClose:t,onAddAsset:se})});if(m||s.assetsToUploadLength>0&&s.uploadedAssets.length===0&&!j)return e.jsxs(p.Content,{children:[e.jsx(p.Header,{children:e.jsx(p.Title,{children:n({id:r("ai.modal.uploading.title"),defaultMessage:"Uploading and processing with AI..."})})}),e.jsx(Ee,{children:e.jsx(Es,{count:s.assetsToUploadLength})})]});const L=n({id:r("ai.modal.title"),defaultMessage:"{count, plural, one {# asset uploaded} other {# assets uploaded}}, review AI generated metadata"},{count:s.uploadedAssets.length});return j?e.jsxs(p.Content,{children:[e.jsx(p.Header,{children:e.jsx(p.Title,{children:L})}),e.jsx(p.Body,{children:e.jsx(Ls,{closeLabel:"",variant:"danger",children:n({id:r("ai.modal.error"),defaultMessage:"Could not generate AI metadata for the uploaded files."})})}),e.jsxs(p.Footer,{children:[e.jsx(k,{onClick:N,variant:"tertiary",children:n({id:"cancel",defaultMessage:"Cancel"})}),e.jsx(k,{onClick:S,loading:h,children:n({id:"global.finish",defaultMessage:"Finish"})})]})]}):e.jsxs(p.Content,{children:[e.jsx(p.Header,{children:e.jsx(p.Title,{children:L})}),e.jsx(Ee,{children:e.jsx(F,{gap:6,direction:"column",alignItems:"stretch",children:s.uploadedAssets.map(({file:c,wasCaptionChanged:C,wasAltTextChanged:b})=>e.jsx(Ts,{asset:c,onCaptionChange:B=>c.id&&M(c.id,B),onAltTextChange:B=>c.id&&i(c.id,B),wasCaptionChanged:C,wasAltTextChanged:b},c.id))})}),e.jsxs(p.Footer,{children:[e.jsx(k,{onClick:N,variant:"tertiary",children:n({id:"cancel",defaultMessage:"Cancel"})}),e.jsx(k,{onClick:S,loading:h,children:n({id:"global.finish",defaultMessage:"Finish"})})]})]})},[_s,O]=jt("AIUploadModalContext"),$s=(t,n)=>yt(t,s=>{if(n.type==="set_uploaded_assets"&&(s.uploadedAssets=n.payload.map(a=>({file:a,wasCaptionChanged:!1,wasAltTextChanged:!1})),s.hasUnsavedChanges=!1),n.type==="set_assets_to_upload_length"&&(s.assetsToUploadLength=n.payload),n.type==="set_uploaded_asset_caption"){const a=s.uploadedAssets.find(l=>l.file.id===n.payload.id);a&&a.file.caption!==n.payload.caption&&(a.file.caption=n.payload.caption,a.wasCaptionChanged=!0,s.hasUnsavedChanges=!0)}if(n.type==="set_uploaded_asset_alt_text"){const a=s.uploadedAssets.find(l=>l.file.id===n.payload.id);a&&a.file.alternativeText!==n.payload.altText&&(a.file.alternativeText=n.payload.altText,a.wasAltTextChanged=!0,s.hasUnsavedChanges=!0)}if(n.type==="remove_uploaded_asset"&&(s.uploadedAssets=s.uploadedAssets.filter(a=>a.file.id!==n.payload.id)),n.type==="edit_uploaded_asset"){const a=s.uploadedAssets.findIndex(l=>l.file.id===n.payload.editedAsset.id);a!==-1&&(s.uploadedAssets[a]={file:n.payload.editedAsset,wasCaptionChanged:s.uploadedAssets[a].wasCaptionChanged,wasAltTextChanged:s.uploadedAssets[a].wasAltTextChanged})}n.type==="clear_unsaved_changes"&&(s.hasUnsavedChanges=!1,s.uploadedAssets.forEach(a=>{a.wasCaptionChanged=!1,a.wasAltTextChanged=!1}))}),Us=({open:t,onClose:n,folderId:s=null})=>{const[a,l]=y.useReducer($s,{uploadedAssets:[],assetsToUploadLength:0,hasUnsavedChanges:!1}),o=y.useCallback(()=>{l({type:"set_uploaded_assets",payload:[]}),n()},[n]);return e.jsx(_s,{state:a,dispatch:l,folderId:s,onClose:o,children:e.jsx(p.Root,{open:t,onOpenChange:o,children:e.jsx(Rs,{onClose:o})})})},Bs=t=>{const{id:n}=vt();return e.jsx(w,{position:"relative",zIndex:2,children:e.jsx(Ne,{"aria-labelledby":`${n}-title`,...t})})},Ds=()=>{const t=Mt(),{status:n,data:s}=wt(t);return t?{status:n,isEnabled:s?.aiMetadata}:{status:"success",isEnabled:!1}},Ps=(t,{pathname:n,query:s})=>{const a=[{id:null,label:{id:r("plugin.name"),defaultMessage:"Media Library"},href:t?G(n,s||{}):void 0}];return t?.parent&&typeof t?.parent!="number"&&t?.parent?.parent&&a.push([]),t?.parent&&typeof t.parent!="number"&&a.push({id:t.parent.id,label:t.parent.name,href:G(n,s||{},{folder:t.parent.id?.toString(),folderPath:t.parent.path})}),t&&a.push({id:t.id,label:t.name}),a},Vs=({selected:t,onSuccess:n})=>{const{formatMessage:s}=A(),{remove:a}=St(),l=async()=>{await a(t),n()};return e.jsxs(Z.Root,{children:[e.jsx(Z.Trigger,{children:e.jsx(k,{variant:"danger-light",size:"S",startIcon:e.jsx(ze,{}),children:s({id:"global.delete",defaultMessage:"Delete"})})}),e.jsx(Oe,{onConfirm:l})]})},Qs=()=>{const{formatMessage:t}=A(),{toggleNotification:n}=_e(),s=$e(),{post:a}=Ue(),o=Be(({destinationFolderId:h,filesAndFolders:m})=>{const g=m.reduce((j,f)=>{const{id:x,type:M}=f,i=M==="asset"?"fileIds":"folderIds";return j[i]||(j[i]=[]),j[i].push(x),j},{});return a("/upload/actions/bulk-move",{...g,destinationFolderId:h})},{onSuccess(h){const{data:{data:m}}=h;m?.files?.length>0&&(s.refetchQueries([Q,"assets"],{active:!0}),s.refetchQueries([Q,"asset-count"],{active:!0})),s.refetchQueries([Q,"folders"],{active:!0}),n({type:"success",message:t({id:r("modal.move.success-label"),defaultMessage:"Elements have been moved successfully."})})}});return{...o,move:(h,m)=>o.mutateAsync({destinationFolderId:h,filesAndFolders:m})}},zs=({onClose:t,selected:n=[],currentFolder:s})=>{const{formatMessage:a}=A(),{data:l,isLoading:o}=Ft(),{move:u}=Qs();if(!l)return null;const h=async(g,{setErrors:j})=>{try{if(typeof g.destination!="string"){const f=g.destination.value;await u(f,n),t()}}catch(f){const x=Lt(f);if(x&&"errors"in x){const M=x.errors?.reduce((i,I)=>(i[I.values?.path?.length||"destination"]=I.defaultMessage,i),{});Rt(M)||j(M)}}};if(o)return e.jsx(p.Content,{children:e.jsx(p.Body,{children:e.jsx(F,{justifyContent:"center",paddingTop:4,paddingBottom:4,children:e.jsx(kt,{children:a({id:r("content.isLoading"),defaultMessage:"Content is loading."})})})})});const m={destination:{value:s?.id||"",label:s?.name||l[0].label}};return e.jsx(p.Content,{children:e.jsx(It,{validateOnChange:!1,onSubmit:h,initialValues:m,children:({values:g,errors:j,setFieldValue:f})=>e.jsxs(Tt,{noValidate:!0,children:[e.jsx(p.Header,{children:e.jsx(p.Title,{children:a({id:r("modal.folder.move.title"),defaultMessage:"Move elements to"})})}),e.jsx(p.Body,{children:e.jsx($.Root,{gap:4,children:e.jsx($.Item,{xs:12,col:12,direction:"column",alignItems:"stretch",children:e.jsxs(D.Root,{id:"folder-destination",children:[e.jsx(D.Label,{children:a({id:r("form.input.label.folder-location"),defaultMessage:"Location"})}),e.jsx(Et,{options:l,onChange:x=>{f("destination",x)},defaultValue:typeof g.destination!="string"?g.destination:void 0,name:"destination",menuPortalTarget:document.querySelector("body"),inputId:"folder-destination",error:j?.destination,ariaErrorMessage:"destination-error"}),j.destination&&e.jsx(ee,{variant:"pi",tag:"p",textColor:"danger600",children:j.destination})]})})})}),e.jsxs(p.Footer,{children:[e.jsx(p.Close,{children:e.jsx(k,{variant:"tertiary",name:"cancel",children:a({id:"cancel",defaultMessage:"Cancel"})})}),e.jsx(k,{type:"submit",loading:o,children:a({id:"modal.folder.move.submit",defaultMessage:"Move"})})]})]})})})},Os=({selected:t=[],onSuccess:n,currentFolder:s})=>{const{formatMessage:a}=A(),[l,o]=y.useState(!1),u=()=>{o(!1),n()};return e.jsxs(p.Root,{open:l,onOpenChange:o,children:[e.jsx(p.Trigger,{children:e.jsx(k,{variant:"secondary",size:"S",startIcon:e.jsx(_t,{}),children:a({id:"global.move",defaultMessage:"Move"})})}),e.jsx(zs,{currentFolder:s,onClose:u,selected:t})]})},Hs=({selected:t=[],onSuccess:n,currentFolder:s})=>{const{formatMessage:a}=A(),l=t?.reduce(function(o,u){return u?.type==="folder"&&"files"in u&&u?.files&&"count"in u.files?o+u?.files?.count:o+1},0);return e.jsxs(F,{gap:2,paddingBottom:5,children:[e.jsx(ee,{variant:"epsilon",textColor:"neutral600",children:a({id:r("list.assets.selected"),defaultMessage:"{numberFolders, plural, one {1 folder} other {# folders}} - {numberAssets, plural, one {1 asset} other {# assets}} selected"},{numberFolders:t?.filter(({type:o})=>o==="folder").length,numberAssets:l})}),e.jsx(Vs,{selected:t,onSuccess:n}),e.jsx(Os,{currentFolder:s,selected:t,onSuccess:n})]})},Gs=({isFiltering:t,canCreate:n,canRead:s})=>t?{id:"list.assets-empty.title-withSearch",defaultMessage:"There are no elements with the applied filters"}:s?n?{id:"list.assets.empty-upload",defaultMessage:"Upload your first assets..."}:{id:"list.assets.empty",defaultMessage:"Media Library is empty"}:{id:"header.actions.no-permissions",defaultMessage:"No permissions to view"},Ns=({canCreate:t,isFiltering:n,canRead:s,onActionClick:a})=>{const{formatMessage:l}=A(),o=Gs({isFiltering:n,canCreate:t,canRead:s});return e.jsx($t,{icon:s?void 0:Ut,action:t&&!n&&e.jsx(k,{variant:"secondary",startIcon:e.jsx(ue,{}),onClick:a,children:l({id:r("header.actions.add-assets"),defaultMessage:"Add new assets"})}),content:l({...o,id:r(o.id)})})},Ws=()=>{const[t,n]=y.useState(!1),{formatMessage:s}=A(),{trackUsage:a}=Ge(),[{query:l},o]=te(),u=l?.filters?.$and||[],h=g=>{o({filters:{$and:g},page:1})},m=g=>{a("didFilterMediaLibraryElements",{location:"content-manager",filter:Object.keys(g[g.length-1])[0]}),o({filters:{$and:g},page:1})};return e.jsxs(ke.Root,{open:t,onOpenChange:n,children:[e.jsx(ke.Trigger,{children:e.jsx(k,{variant:"tertiary",startIcon:e.jsx(Bt,{}),size:"S",children:s({id:"app.utils.filters",defaultMessage:"Filters"})})}),e.jsx(Dt,{displayedFilters:Ie,filters:u,onSubmit:m,onToggle:n}),e.jsx(Pt,{appliedFilters:u,filtersSchema:Ie,onRemoveFilter:h})]})},qs=({breadcrumbs:t=null,canCreate:n,folder:s=null,onToggleEditFolderDialog:a,onToggleUploadAssetDialog:l})=>{const{formatMessage:o}=A(),{pathname:u}=We(),[{query:h}]=te(),m={...h,folder:s?.parent&&typeof s.parent!="number"&&s.parent.id?s.parent.id:void 0,folderPath:s?.parent&&typeof s.parent!="number"&&s.parent.path?s.parent.path:void 0};return e.jsx(Y.Header,{title:o({id:r("plugin.name"),defaultMessage:"Media Library"}),subtitle:t&&typeof t!="boolean"&&s&&e.jsx(Ot,{label:o({id:r("header.breadcrumbs.nav.label"),defaultMessage:"Folders navigation"}),breadcrumbs:t,currentFolderId:s?.id}),navigationAction:s&&e.jsx(Vt,{tag:Qt,startIcon:e.jsx(zt,{}),to:`${u}?${qe.stringify(m,{encode:!1})}`,children:o({id:r("header.actions.folder-level-up"),defaultMessage:"Back"})}),primaryAction:n&&e.jsxs(F,{gap:2,children:[e.jsx(k,{startIcon:e.jsx(ue,{}),variant:"secondary",onClick:a,children:o({id:r("header.actions.add-folder"),defaultMessage:"Add new folder"})}),e.jsx(k,{startIcon:e.jsx(ue,{}),onClick:l,children:o({id:r("header.actions.add-assets"),defaultMessage:"Add new assets"})})]})})},Js=v(w)`
  height: 3.2rem;
  display: flex;
  align-items: center;
`,Le=v(ee)`
  max-width: 100%;
`,Re=v(w)`
  svg {
    path {
      fill: ${({theme:t})=>t.colors.neutral500};
    }
  }
`,Ks=()=>{const t=Ht(),{canRead:n,canCreate:s,canUpdate:a,canCopyLink:l,canDownload:o,canConfigureView:u,isLoading:h}=Qe(),{isEnabled:m,status:g}=Ds(),j=y.useRef(),{formatMessage:f}=A(),{pathname:x}=We(),{trackUsage:M}=Gt(),[{query:i},I]=te(),S=!!(i._q||i.filters),[N,se]=Nt(gs.view,X.GRID),L=N===X.GRID,{data:c,isLoading:C,error:b}=Wt({skipWhen:!n,query:i}),{data:B,isLoading:U,error:Ke}=qt({enabled:n&&c?.pagination?.page===1&&!Jt(i),query:i}),{data:ae,isLoading:pe,error:Xe}=Kt(i?.folder,{enabled:n&&!!i?.folder});Xe?.name==="NotFoundError"&&t(x);const W=B?.map(d=>({...d,type:"folder",folderURL:G(x,i,{folder:d.id.toString(),folderPath:d.path}),isSelectable:a}))??[],T=W?.length||0,q=c?.results?.map(d=>({...d,type:"asset",isSelectable:a}))||[],E=q?.length??0,Ye=c?.pagination?.total,Ze=pe||U||h||C||g==="loading",[ne,et]=y.useState(!1),[he,ge]=y.useState(!1),[ie,oe]=y.useState(void 0),[de,fe]=y.useState(void 0),[R,{selectOne:le,selectAll:xe,setSelections:me}]=Xt(["type","id"],[]);y.useEffect(()=>{me([])},[i.folder,me]);const je=R?.length>0&&R?.length!==E+T,J=()=>et(d=>!d),ye=({created:d=!1}={})=>{d&&i?.page!=="1"&&I({...i,page:1}),ge(V=>!V)},Ce=(d,V)=>{d&&M("didSelectAllMediaLibraryElements"),xe(V)},be=d=>{M("didSortMediaLibraryElements",{location:"upload",sort:d}),I({sort:d})},Ae=d=>{fe(d),ge(!0)},tt=d=>{fe(null),ye(d),j.current&&j.current.focus()},ve=d=>{d===E&&c?.pagination?.page===c?.pagination?.pageCount&&c?.pagination?.page&&c.pagination.page>1&&I({...i,page:c.pagination.page-1})},st=()=>{xe(),ve(R.length)};return Ze?e.jsx(P.Loading,{}):b||Ke||g==="error"?e.jsx(P.Error,{}):e.jsxs(Y.Root,{children:[e.jsxs(P.Main,{children:[e.jsx(qs,{breadcrumbs:pe?null:Ps(ae,{pathname:x,query:i}),canCreate:s,onToggleEditFolderDialog:ye,onToggleUploadAssetDialog:J,folder:ae}),e.jsx(Y.Action,{startActions:e.jsxs(e.Fragment,{children:[a&&L&&(E>0||T>0)&&e.jsx(Js,{paddingLeft:2,paddingRight:2,background:"neutral0",hasRadius:!0,borderColor:"neutral200",children:e.jsx(Ne,{"aria-label":f({id:r("bulk.select.label"),defaultMessage:"Select all folders & assets"}),checked:je?"indeterminate":(E>0||T>0)&&R.length===E+T,onCheckedChange:d=>Ce(d,[...q,...W])})}),n&&L&&e.jsx(ss,{value:i?.sort,onChangeSort:be}),n&&e.jsx(Ws,{})]}),endActions:e.jsxs(e.Fragment,{children:[u?e.jsx(Re,{paddingTop:1,paddingBottom:1,children:e.jsx(H,{tag:Yt,to:{pathname:`${x}/configuration`,search:qe.stringify(i,{encode:!1})},label:f({id:"app.links.configure-view",defaultMessage:"Configure the view"}),children:e.jsx(Zt,{})})}):null,e.jsx(Re,{paddingTop:1,paddingBottom:1,children:e.jsx(H,{label:f(L?{id:r("view-switch.list"),defaultMessage:"List View"}:{id:r("view-switch.grid"),defaultMessage:"Grid View"}),onClick:()=>se(L?X.LIST:X.GRID),children:L?e.jsx(es,{}):e.jsx(ts,{})})}),e.jsx(js,{label:f({id:r("search.label"),defaultMessage:"Search for an asset"}),trackedEvent:"didSearchMediaLibraryElements",trackedEventDetails:{location:"upload"}})]})}),e.jsxs(Y.Content,{children:[R.length>0&&e.jsx(Hs,{currentFolder:ae,selected:R,onSuccess:st}),T===0&&E===0&&e.jsx(Ns,{canCreate:s,canRead:n,isFiltering:S,onActionClick:J}),n&&!L&&(E>0||T>0)&&e.jsx(as,{assetCount:E,folderCount:T,indeterminate:je,onChangeSort:be,onChangeFolder:(d,V)=>t(G(x,i,{folder:d.toString(),folderPath:V})),onEditAsset:oe,onEditFolder:Ae,onSelectOne:le,onSelectAll:Ce,rows:[...W,...q],selected:R,shouldDisableBulkSelect:!a,sortQuery:i?.sort??""}),n&&L&&e.jsxs(e.Fragment,{children:[T>0&&e.jsx(ns,{title:(S&&E>0||!S)&&f({id:r("list.folders.title"),defaultMessage:"Folders ({count})"},{count:T})||"",children:W.map(d=>{const at=!!R.filter(({type:re})=>re==="folder").find(re=>re.id===d.id),Me=G(x,i,{folder:d?.id.toString(),folderPath:d?.path});return e.jsx($.Item,{col:3,direction:"column",alignItems:"stretch",children:e.jsx(is,{ref:de&&d.id===de.id?j:void 0,ariaLabel:d.name,id:`folder-${d.id}`,to:Me,startAction:d.isSelectable?e.jsx(Bs,{"data-testid":`folder-checkbox-${d.id}`,checked:at,onCheckedChange:()=>le(d)}):null,cardActions:e.jsx(H,{label:f({id:r("list.folder.edit"),defaultMessage:"Edit folder"}),onClick:()=>Ae(d),children:e.jsx(He,{})}),children:e.jsx(os,{children:e.jsx(ds,{to:Me,children:e.jsxs(F,{tag:"h2",direction:"column",alignItems:"start",maxWidth:"100%",children:[e.jsxs(Le,{fontWeight:"semiBold",textColor:"neutral800",ellipsis:!0,children:[d.name,e.jsx(ls,{children:":"})]}),e.jsx(Le,{tag:"span",textColor:"neutral600",variant:"pi",ellipsis:!0,children:f({id:r("list.folder.subtitle"),defaultMessage:"{folderCount, plural, =0 {# folder} one {# folder} other {# folders}}, {filesCount, plural, =0 {# asset} one {# asset} other {# assets}}"},{folderCount:d.children?.count,filesCount:d.files?.count})})]})})})})},`folder-${d.id}`)})}),E>0&&T>0&&e.jsx(w,{paddingTop:6,paddingBottom:4,children:e.jsx(rs,{})}),E>0&&e.jsx(cs,{assets:q,onEditAsset:oe,onSelectAsset:le,selectedAssets:R.filter(({type:d})=>d==="asset"),title:(!S||S&&T>0)&&c?.pagination?.page===1&&f({id:r("list.assets.title"),defaultMessage:"Assets ({count})"},{count:Ye})||""})]}),e.jsxs(ce.Root,{...c?.pagination,children:[e.jsx(ce.PageSize,{}),e.jsx(ce.Links,{})]})]})]}),ne&&(m?e.jsx(Us,{open:ne,onClose:J,folderId:i?.folder?Number(i.folder):null}):e.jsx(us,{open:ne,onClose:J,trackedLocation:"upload",folderId:i?.folder})),he&&e.jsx(ps,{open:he,onClose:()=>tt(),folder:de,parentFolderId:i?.folder,location:"upload"}),ie&&e.jsx(hs,{onClose:d=>{d===null&&ve(1),oe(void 0)},open:!!ie,asset:ie,canUpdate:a,canCopyLink:l,canDownload:o,trackedLocation:"upload"})]})},Xs=y.lazy(async()=>ms(()=>import("./ConfigureTheView-B13Ta6yT.js"),__vite__mapDeps([0,1,2])).then(t=>({default:t.ConfigureTheView}))),ea=()=>{const{config:{isLoading:t,isError:n,data:s}}=fs(),[{rawQuery:a},l]=te(),{formatMessage:o}=A(),u=o({id:r("plugin.name"),defaultMessage:"Media Library"});return y.useEffect(()=>{t||n||a||l({sort:s.sort,page:1,pageSize:s.pageSize})},[t,n,s,a,l]),t?e.jsx(P.Loading,{}):e.jsxs(P.Main,{children:[e.jsx(P.Title,{children:u}),a?e.jsx(y.Suspense,{fallback:e.jsx(P.Loading,{}),children:e.jsxs(xs,{children:[e.jsx(Te,{index:!0,element:e.jsx(Ks,{})}),e.jsx(Te,{path:"configuration",element:e.jsx(Xs,{config:s})})]})}):null]})};export{ea as Upload};
